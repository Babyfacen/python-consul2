language: python

python:
  - 2.7
  - pypy
  - 3.5
  - 3.6
  - 3.7

install:
  - pip install tox
  - pip install tox-travis

script:
  - tox

jobs:
  include:
    - stage: flake
      python: 3.7
      script:
        - tox -e flake8
    - stage: sonar
      dist: trusty
      language: python
      addons:
        sonarcloud:
          organization: "python-consul2"
          token:
            secure: "ph5YrfxHBRp1wvMwZ4S63ADE8dNhTHiaHv1ur7GSq8ZxPEKM+inrt1P9Mv+iA0NP84SpDfm+/PSL96OLlxz0RonvLJM6F6CXz2CPapuNhsDqQ/fmaWtQ6ejfaqp48j8Us/IxSLeFVqUei+akQLSwlC4eHwF07OJaRMx2hqBsU+vfWJ9tfnD6Uu53iwjMlIo4k4f3bfhXULbR8BwO3YeDOcNWnWG+it7skICbvrlY/Fs3/bKHtn0SAuVEDaY8+I1bdrmW9eeFguPMvanN3w9QER06a+wWtmNwdrs0WGw8TIt5zwEKWwzMHSYzj5bE3ps9vbJ5Qh12iJqoBlx8g3vQePv35deDyy7kHqSOeYkY/5EygLuO9vn/X9jekqgL5s3rLCkQxiaE/lAhn5g8iQYWokeNjQNWQQ2G0ojkeXM1gYHQdEOwnYFDnPi9hpeCqAgu1ZkrCe5M7bPA8Cn3S8yeaO+LqpLLn046zg65kcTcWyCYJxUl4tZT7C3wugMcr/fY8XDTzPc41sx14vmbPvP6Pp/bqBc9E9mBbxPzo5U0vE/Y1nNL0G5jprsBD95wP9UcjCOEo1YZtd3qbh1nGePxgq6j9RligOjjJSPIILcGNPwwAtSu7kr4ft5tpZ+LnFzPuWnRC8se7YVvoGCHicqu9CqtkZ/l348HQod3Swu2VxM="
          branches:
            - master
      install: ignore
      script:
        - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then sonar-scanner; fi'
      branches:
        only:
          - master
    - stage: deploy
      python: 3.7
      script: ignore
      deploy:
        provider: pypi
        user: poppys
        password:
          secure: "pypi-AgEIcHlwaS5vcmcCJDhmM2FlZWM0LTI5ZDgtNGE5Mi1iNmIzLTEzNTJjZDI4MTUzNQACJXsicGVybWlzc2lvbnMiOiAidXNlciIsICJ2ZXJzaW9uIjogMX0AAAYgrDqv9U4X4c4brB_seoPBscZPh66_5gjrZtoVwuK015U"
        distributions: "sdist bdist_wheel"
        on:
          tags: true
